<html>
<head>
    <script src="jquery-3.7.1.min.js"></script>
    <style>
        /* Basic styles for the early '90s internet look */
        body {
            font-family: "Courier New", Courier, monospace;
            background-color: #f0f0f0;
            color: #000;
        }

        h1 {
            color: #000080;
            text-align: center;
        }

        /* Container for the table to enable horizontal scrolling */
        #answersContainer {
            overflow-x: auto;
            white-space: nowrap;
            max-width: 100%;
            margin: 20px;
            border: 1px solid #000;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: auto;
            min-width: 1000px; /* Set a minimum width to trigger horizontal scrolling */
        }

        th, td {
            border: 1px solid #000;
            padding: 5px;
            text-align: left;
            background-color: #e0e0e0;
        }

        th {
            background-color: #c0c0c0;
            color: #000;
            cursor: ew-resize; /* Cursor indicating that the header can be resized */
        }

        /* Add styling for a resizable header */
        th.resizable {
            position: relative;
        }

        th.resizable::after {
            content: "";
            position: absolute;
            top: 0;
            right: 0;
            width: 5px;
            height: 100%;
            cursor: ew-resize;
            background-color: #ddd;
        }

        th.resizable:hover::after {
            background-color: #aaa;
        }

        td {
            background-color: #fff;
            color: #000;
        }
    </style>
</head>
<body>
    <h1>Survey Results</h1>
    <div id="answersContainer">
        <!-- Table will be inserted here -->
    </div>

    <script>
        // Load all questions and their corresponding answers
        function loadAnswers() {
            $.get("http://localhost:8000/questions/", function (questions) {
                $.get("http://localhost:8000/answers/", function (answers) {
                    displayAnswers(questions, answers);
                });
            });
        }

        // Function to display the survey results in a table format
        function displayAnswers(questions, answers) {
            var table = $("<table/>");

            // Create the header row with questions as column headers
            var headerRow = $("<tr/>");
            headerRow.append($("<th/>").text("Response ID"));
            $.each(questions, function (i, question) {
                headerRow.append($("<th class='resizable'/>").text(question.text));
            });
            table.append(headerRow);

            // Group answers by response ID (assuming one answer per question per response)
            var groupedAnswers = {};
            $.each(answers, function (i, answer) {
                if (!groupedAnswers[answer.submission_id]) {
                    groupedAnswers[answer.submission_id] = {};
                }
                groupedAnswers[answer.submission_id][answer.question_id] = answer.value;
            });

            // Create a row for each set of responses
            $.each(groupedAnswers, function (responseId, responseAnswers) {
                var row = $("<tr/>");
                row.append($("<td/>").text(responseId));
                $.each(questions, function (i, question) {
                    var answerText = responseAnswers[question.id] || "No response";
                    row.append($("<td/>").text(answerText));
                });
                table.append(row);
            });

            $('#answersContainer').html(table);

            // Enable resizing columns
            enableColumnResizing();
        }

        function enableColumnResizing() {
            $('th.resizable').each(function () {
                var th = $(this);
                th.on('mousedown', function (e) {
                    var startX = e.pageX;
                    var startWidth = th.width();

                    $(document).on('mousemove', function (e) {
                        var newWidth = startWidth + (e.pageX - startX);
                        th.width(newWidth);
                        th.css('max-width', newWidth);
                    });

                    $(document).on('mouseup', function () {
                        $(document).off('mousemove');
                    });
                });
            });
        }

        // Load the survey data when the page is ready
        $(document).ready(function () {
            loadAnswers();
        });
    </script>
</body>
</html>
