<html>
<head>
    <script src="jquery-3.7.1.min.js"></script>
    <style>
        /* Basic styles for the early '90s internet look */
        body {
            font-family: "Courier New", Courier, monospace;
            background-color: #f0f0f0;
            color: #000;
            overflow-x: auto; /* Enable horizontal scrolling for the entire page */
        }

        h1 {
            color: #000080;
            text-align: center;
        }

        table {
            border-collapse: collapse;
            width: auto;
            table-layout: fixed; /* Fixed layout to allow column resizing */
            min-width: 1000px; /* Ensure table stretches enough to allow horizontal scrolling */
        }

        th, td {
            border: 1px solid #000;
            padding: 5px;
            text-align: left;
            background-color: #e0e0e0;
            position: relative;
        }

        th {
            background-color: #c0c0c0;
            color: #000;
            position: relative;
            cursor: ew-resize; /* Cursor indicates that the header can be resized */
        }

        /* Resizer styling */
        th .resizer {
            position: absolute;
            top: 0;
            right: 0;
            width: 5px;
            height: 100%;
            cursor: ew-resize;
            user-select: none;
            z-index: 10;
        }

        th.resizing {
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <h1>Survey Results</h1>
    <table>
        <!-- Table will be inserted here -->
    </table>

    <script>
        // Load all questions and their corresponding answers
        function loadAnswers() {
            $.get("http://localhost:8000/questions/", function (questions) {
                $.get("http://localhost:8000/answers/", function (answers) {
                    displayAnswers(questions, answers);
                });
            });
        }

        // Function to display the survey results in a table format
        function displayAnswers(questions, answers) {
            var table = $("table");

            // Create the header row with questions as column headers
            var headerRow = $("<tr/>");
            $.each(questions, function (i, question) {
                var th = $("<th/>").text(question.text);
                var resizer = $("<div class='resizer'/>");
                th.append(resizer); // Add resizer div to header
                headerRow.append(th);
            });
            table.append(headerRow);

            // Group answers by response ID (assuming one answer per question per response)
            var groupedAnswers = {};
            $.each(answers, function (i, answer) {
                if (!groupedAnswers[answer.submission_id]) {
                    groupedAnswers[answer.submission_id] = {};
                }
                groupedAnswers[answer.submission_id][answer.question_id] = answer.value;
            });

            // Create a row for each set of responses
            $.each(groupedAnswers, function (responseId, responseAnswers) {
                var row = $("<tr/>");
                $.each(questions, function (i, question) {
                    var answerText = responseAnswers[question.id] || "No response";
                    row.append($("<td/>").text(answerText));
                });
                table.append(row);
            });

            // Enable resizing columns
            enableColumnResizing();
        }

        function enableColumnResizing() {
            const thElements = document.querySelectorAll('th');

            thElements.forEach(th => {
                const resizer = th.querySelector('.resizer');

                resizer.addEventListener('mousedown', function (e) {
                    const startX = e.pageX;
                    const startWidth = th.offsetWidth;

                    const resizeColumn = (e) => {
                        const newWidth = startWidth + (e.pageX - startX);
                        th.style.minWidth = `${newWidth}px`;
                        console.log("resizing!");
                    };

                    const stopResize = () => {
                        document.removeEventListener('mousemove', resizeColumn);
                        document.removeEventListener('mouseup', stopResize);
                        th.classList.remove('resizing');
                        document.body.style.cursor = 'default';
                        document.body.style.userSelect = 'auto';
                    };

                    document.addEventListener('mousemove', resizeColumn);
                    document.addEventListener('mouseup', stopResize);

                    // Prevent text selection during resize
                    document.body.style.cursor = 'ew-resize';
                    document.body.style.userSelect = 'none';

                    th.classList.add('resizing');
                });
            });
        }

        // Load the survey data when the page is ready
        $(document).ready(function () {
            loadAnswers();
        });
    </script>
</body>
</html>
