<html>
<head>
    <script src="jquery-3.7.1.min.js"></script>
</head>

<div id="questionsContainer">

</div>

<script>

    $(document).on("submit", "form", function(event)
    {
        event.preventDefault();

        var url=$(this).attr("action");
        $.ajax({
            url: url,
            type: $(this).attr("method"),
            dataType: "JSON",
            data: new FormData(this),
            processData: false,
            contentType: false,
            beforeSend: function()
            {
                $("#message").html("sending...");
            },
            success: function(data)
            {
                $("#message").html("");
                getAllQuestions(); // Refresh all the data (yeah, inefficient AF, sue me)
            },
            error: function (xhr, description, error)
            {
                $("#message").html(xhr.responseText);
                $([document.documentElement, document.body]).animate({scrollTop: $("#message").offset().top}, 500);
            }
        });
    });

    function getAllQuestions() {
        $.get("http://localhost:8000/questions/", function (data) {
            updateTable(data);
        });
    }

    function updateTable(response) {
        // Clear the old data (if any!)
        $('#questionsContainer').empty();

        // Go over all the questions
        $.each(response, function (i, question) {
            var form = $("<form/>", {
                action: "http://localhost:8000/questions/" + question.id,
                method: "put"
            });

            // Change the text of the question
            form.append($("<label>", {}).text("Question text: "));
            form.append($("<input>", {
                type: "text",
                name: "text",
                value: question.text
            }));
            form.append($("<br>"))
            // Change the type of the question
            form.append($("<label>").text("Question Type: "));
            var select = $("<select>", {name:"type"});
            console.log(question.type)
            select.append($("<option>", {value:"pickone", selected: question.type === "pickone"}).text("Pick one"));
            select.append($("<option>", {value:"freeform", selected: question.type === "freeform"}).text("Text"));
            select.append($("<option>", {value:"boolean", selected: question.type === "boolean"}).text("Boolean"));
            form.append(select);

            // Allow the multiple choice options to be changed
            if (question.type === "pickone") {
                var table = $("<table/>");
                var tr = $("<tr/>");
                tr.append($("<th>").text("options"));
                var th = $("<th>");
                $.each(question.options, function (j, option) {
                    th.append($("<input/>", {type:"text", name: "option_" + option.order, value: option.value}));
                    th.append($("<br>"));
                });
                tr.append(th);
                table.append(tr);
                form.append(table);
            }

            form.append($("<input>", {type: "submit", value: "save"}))
            form.appendTo("#questionsContainer");
            $("<hr>").appendTo("#questionsContainer");
        });
    }

    getAllQuestions();

</script>
</html>
